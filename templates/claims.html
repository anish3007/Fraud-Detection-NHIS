<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Claims Review</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  </head>
  <body class="p-4">
    <div class="container">
      <h1>Claims Review</h1>
      <div class="mb-3">
        <input id="q" class="form-control" placeholder="Search by diagnosis, patient id...">
      </div>
      <div id="claimsList" class="list-group"></div>
      <div class="my-3">
        <button id="loadMore" class="btn btn-primary">Load more</button>
      </div>
    </div>

    <script>
      let offset = 0;
      const limit = 25;
      async function loadClaims(reset=false){
        const q = document.getElementById('q').value || '';
        if(reset){ offset = 0; document.getElementById('claimsList').innerHTML = ''; }
        const res = await fetch(`/api/claims?q=${encodeURIComponent(q)}&limit=${limit}&offset=${offset}`);
        const data = await res.json();
        data.items.forEach(c => {
          const el = document.createElement('div');
          el.className = 'list-group-item';
          // choose badge color
          let badgeClass = 'bg-success';
          if(c.fraud_score > 75) badgeClass = 'bg-danger';
          else if(c.fraud_score >= 25) badgeClass = 'bg-warning text-dark';
          const age = c.age || c.patient_age || '—';
          const gender = c.gender || c.sex || '—';
          el.innerHTML = `<div class="d-flex justify-content-between align-items-start">
            <div>
              <div><strong>Claim</strong> #${c.rowid} — Proc: ${c.procedure_code || 'N/A'} — Patient: ${c.patient_id || 'N/A'}</div>
              <div class="small text-muted">Diagnosis: ${c.diagnosis || '—'}</div>
              <div class="small text-muted">Age: ${age} — Gender: ${gender} — Amount: ${c.billed_amount || '—'}</div>
            </div>
            <div><span class="badge ${badgeClass}">Score: ${c.fraud_score}</span></div>
          </div>`;
          document.getElementById('claimsList').appendChild(el);
        });
        offset += data.items.length;
        if(data.items.length < limit){ document.getElementById('loadMore').disabled = true; }
      }
      document.getElementById('loadMore').addEventListener('click', () => loadClaims());
      document.getElementById('q').addEventListener('keydown', (e) => { if(e.key === 'Enter') loadClaims(true); });
      // initial load
      loadClaims();
    </script>
  </body>
</html>
